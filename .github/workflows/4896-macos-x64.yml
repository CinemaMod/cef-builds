name: Build CEF 4896 for macOS x64

# --force-clean

on: [workflow_dispatch]

env:
  GN_DEFINES: is_official_build=true use_thin_lto=false proprietary_codecs=true ffmpeg_branding=Chrome
  CEF_ARCHIVE_FORMAT: tar.bz2

jobs:
  cef-macos-x64:
    runs-on: [self-hosted, macOS, X64]
    timeout-minutes: 720
    steps:
      - run: |
          curl https://bitbucket.org/chromiumembedded/cef/raw/master/tools/automate/automate-git.py -o automate-git.py
          python3 automate-git.py --download-dir=/Users/cef/cef --force-clean --branch=4896 --minimal-distrib --client-distrib --x64-build --with-pgo-profiles --no-debug-build
          s3cmd sync /Users/cef/cef/chromium/src/cef/binary_distrib/ --exclude "*" --include "*.tar.bz2" s3://cef-builds/4896/
